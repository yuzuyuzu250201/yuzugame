<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Suika Game - Mobile Optimized</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body { 
            margin: 0; display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; background: #fdf6e3; font-family: 'Pretendard', sans-serif; 
            overflow-x: hidden; padding: 10px; box-sizing: border-box;
        }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ ì»¨í…Œì´ë„ˆ: ëª¨ë°”ì¼ì—ì„œ ì„¸ë¡œ ì •ë ¬ ë˜ëŠ” ìŠ¤ì¼€ì¼ ì¡°ì • */
        #main-wrapper {
            display: flex; justify-content: center; align-items: flex-start; gap: 15px;
            max-width: 100%; transition: transform 0.2s;
        }

        #left-sidebar, #right-sidebar { 
            display: flex; flex-direction: column; gap: 10px; width: 155px;
            flex-shrink: 0;
        }
        
        #center-area { 
            display: flex; flex-direction: column; align-items: center; gap: 10px; 
            flex-shrink: 0;
        }

        /* ìº”ë²„ìŠ¤ í¬ê¸°ë¥¼ ë°˜ì‘í˜•ìœ¼ë¡œ ì¡°ì • */
        #game-container { 
            position: relative; 
            box-shadow: 0 10px 50px rgba(0,0,0,0.2); 
            border-radius: 15px; 
            background: #fff;
            cursor: crosshair;
            touch-action: none; /* ëª¨ë°”ì¼ í„°ì¹˜ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }
        canvas { 
            display: block; border-radius: 15px; 
            max-width: 100%; height: auto !important; 
        }
        
        #limit-line-guide {
            position: absolute; top: 12.5%; left: 0; width: 100%; height: 2px;
            border-top: 2px dashed #e53935; opacity: 0.6; pointer-events: none;
        }

        .ui-box { 
            background: rgba(255, 255, 255, 0.9); padding: 12px; border-radius: 12px; 
            border: 3px solid #5d4037; text-align: center; 
        }
        
        #evolution-chart { text-align: left; display: flex; flex-direction: column; gap: 2px; padding: 8px; }
        .evo-item { display: flex; align-items: center; gap: 5px; font-size: 10px; font-weight: bold; color: #5d4037; }
        .evo-img { width: 18px; height: 18px; border-radius: 50%; border: 1px solid #5d4037; object-fit: cover; }

        .control-group { margin-bottom: 8px; text-align: left; }
        .control-group label { font-size: 10px; font-weight: bold; color: #5d4037; display: block; }
        
        input[type="range"] { width: 100%; cursor: pointer; }
        .mute-wrap { display: flex; align-items: center; gap: 5px; font-size: 11px; font-weight: bold; color: #5d4037; justify-content: center; }
        
        #reset-btn, #launch-btn {
            width: 100%; padding: 8px; cursor: pointer; color: white; border: none; 
            border-radius: 8px; font-weight: bold; font-size: 12px; margin-bottom: 5px;
        }
        #reset-btn { background: #ff7043; }
        #launch-btn { background: #4caf50; }
        #cheat-btn {
            width: 160px; padding: 8px; cursor: pointer; background: #ffeb3b; color: #5d4037;
            border: 3px solid #5d4037; border-radius: 8px; font-weight: bold; font-size: 12px;
        }

        #next-preview { width: 50px; height: 50px; margin: 5px auto; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; overflow: hidden; border-radius: 50%; }
        #next-img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .label { font-size: 11px; color: #8d6e63; font-weight: bold; margin-bottom: 5px; }
        #score-val, #timer-val { font-size: 18px; color: #5d4037; font-weight: bold; }
        #game-warning { font-weight: bold; color: #e53935; font-size: 11px; background: white; padding: 5px 10px; border-radius: 15px; border: 1px solid #e53935; text-align: center; }

        /* ëª¨ë°”ì¼ìš© ë¯¸ë””ì–´ ì¿¼ë¦¬ */
        @media (max-width: 800px) {
            #main-wrapper {
                transform: scale(0.85); /* í™”ë©´ì´ ì‘ìœ¼ë©´ ì „ì²´ì ìœ¼ë¡œ ì¶•ì†Œ */
            }
        }
        @media (max-width: 600px) {
            #main-wrapper {
                transform: scale(0.65); /* ë” ì‘ìœ¼ë©´ ë” ì¶•ì†Œ */
            }
            body { align-items: flex-start; padding-top: 20px; }
        }
    </style>
</head>
<body>

    <div id="main-wrapper">
        <div id="left-sidebar">
            <div class="ui-box">
                <div class="label">AUDIO SETTINGS</div>
                <div class="control-group"><label>BGM</label><input type="range" id="bgm-vol" min="0" max="1" step="0.1" value="0.3"></div>
                <div class="control-group"><label>SFX</label><input type="range" id="sfx-vol" min="0" max="1" step="0.1" value="0.4"></div>
                <div class="mute-wrap"><input type="checkbox" id="mute-chk"> <label for="mute-chk">MUTE</label></div>
            </div>
            <div class="ui-box" id="evolution-chart">
                <div class="label" style="text-align: center;">EVOLUTION</div>
            </div>
        </div>

        <div id="center-area">
            <div id="game-container"><div id="limit-line-guide"></div></div>
            <div id="game-warning">âš ï¸ ì„ ì„ ë„˜ê±°ë‚˜ ê³µì´ ë°–ìœ¼ë¡œ ë–¨ì–´ì§€ë©´ íŒ¨ë°°!</div>
            <button id="cheat-btn">âœ¨ íˆë“  ì¹˜íŠ¸í‚¤ âœ¨</button>
        </div>

        <div id="right-sidebar">
            <div class="ui-box"><div class="label">TIME</div><span id="timer-val">00:00</span></div>
            <div class="ui-box"><div class="label">SCORE</div><span id="score-val">0</span></div>
            <div class="ui-box"><div class="label">NEXT</div><div id="next-preview"><img id="next-img" src="" alt="Next"></div></div>
            <div class="ui-box">
                <button id="reset-btn">RESET</button>
                <button id="launch-btn">ğŸš€ LAUNCH</button>
            </div>
        </div>
    </div>

<script>
const bgm = new Audio('Anyone_in_2025.wav');
bgm.loop = true;
const soundDrop = new Audio('https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3');
const soundMerge = new Audio('https://assets.mixkit.co/active_storage/sfx/2017/2017-preview.mp3');
const soundLaunch = new Audio('https://assets.mixkit.co/active_storage/sfx/2816/2816-preview.mp3');

const FRUITS_CONFIG = [
    { level: 1, radius: 20, img: '1.webp', scale: 0.18, name: 'Lv.1' },
    { level: 2, radius: 28, img: '2.webp', scale: 0.25, name: 'Lv.2' },
    { level: 3, radius: 38, img: '3.webp', scale: 0.35, name: 'Lv.3' },
    { level: 4, radius: 48, img: '4.webp', scale: 0.45, name: 'Lv.4' },
    { level: 5, radius: 58, img: '5.webp', scale: 0.55, name: 'Lv.5' },
    { level: 6, radius: 72, img: '6.webp', scale: 0.68, name: 'Lv.6' },
    { level: 7, radius: 88, img: '7.webp', scale: 0.82, name: 'Lv.7' },
    { level: 8, radius: 105, img: '8.webp', scale: 0.98, name: 'Lv.8' },
    { level: 9, radius: 125, img: '9.webp', scale: 1.15, name: 'Lv.9' },
    { level: 10, radius: 155, img: '10.jpg', scale: 1.40, name: 'Final' }
];

const evoContainer = document.getElementById('evolution-chart');
FRUITS_CONFIG.forEach(c => {
    const d = document.createElement('div'); d.className='evo-item';
    d.innerHTML=`<img src="${c.img}" class="evo-img"><span>${c.name}</span>`;
    evoContainer.appendChild(d);
});

const { Engine, Render, Runner, World, Bodies, Events, Composite, Body } = Matter;
const engine = Engine.create();
engine.world.gravity.y = 1.0; 

const render = Render.create({
    element: document.getElementById('game-container'),
    engine: engine,
    options: { width: 450, height: 800, wireframes: false, background: 'transparent' }
});

Render.run(render);
Runner.run(Runner.create(), engine);

const deathFloor = Bodies.rectangle(225, 850, 2000, 20, { isStatic: true, label: 'deathFloor', render: { fillStyle: 'transparent' } });
World.add(engine.world, [
    deathFloor,
    Bodies.rectangle(225, 795, 430, 20, { isStatic: true, render: { fillStyle: '#5d4037' } }),
    Bodies.rectangle(5, 450, 10, 700, { isStatic: true, render: { fillStyle: '#5d4037' } }),
    Bodies.rectangle(445, 450, 10, 700, { isStatic: true, render: { fillStyle: '#5d4037' } })
]);

let score=0, nextLevel=Math.floor(Math.random()*3)+1, isGameOver=false, isMuted=false, startTime=Date.now(), mouseX=225;

// í„°ì¹˜ ë° ë§ˆìš°ìŠ¤ ì´ë™ ì²˜ë¦¬ (í†µí•©)
const handleMove = (e) => {
    const rect = render.canvas.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const scale = 450 / rect.width; // ì‹¤ì œ ë Œë”ë§ í¬ê¸°ì™€ ìº”ë²„ìŠ¤ ì¢Œí‘œê³„ ë¹„ìœ¨ ë³´ì •
    mouseX = (clientX - rect.left) * scale;
};
render.canvas.addEventListener('mousemove', handleMove);
render.canvas.addEventListener('touchmove', (e) => { e.preventDefault(); handleMove(e); }, {passive: false});

function updateTimer() {
    if (isGameOver) return;
    const s = Math.floor((Date.now()-startTime)/1000);
    document.getElementById('timer-val').innerText = `${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
}
setInterval(updateTimer, 1000);

function createFruit(x, y, level, isMerged=false) {
    const c = FRUITS_CONFIG[level-1];
    const f = Bodies.circle(x, y, c.radius, {
        label: level.toString(), restitution: 0.7, friction: 0.02,
        render: { sprite: { texture: c.img, xScale: c.scale, yScale: c.scale } }
    });
    if (isMerged) Body.setVelocity(f, { x: Matter.Common.random(-3, 3), y: -5 });
    f.spawnTime = Date.now();
    return f;
}

Events.on(render, 'afterRender', () => {
    const ctx = render.context;
    if (!isGameOver) {
        const c = FRUITS_CONFIG[nextLevel-1];
        ctx.save(); ctx.globalAlpha = 0.4;
        ctx.drawImage(document.getElementById('next-img'), mouseX - c.radius, 50 - c.radius, c.radius*2, c.radius*2);
        ctx.beginPath(); ctx.setLineDash([5, 10]); ctx.moveTo(mouseX, 100); ctx.lineTo(mouseX, 780);
        ctx.strokeStyle = '#5d4037'; ctx.lineWidth = 1; ctx.stroke(); ctx.restore();
    }
    Composite.allBodies(engine.world).forEach(b => {
        if (b.circleRadius && !b.isEffect) {
            ctx.beginPath(); ctx.arc(b.position.x, b.position.y, b.circleRadius, 0, 2*Math.PI);
            ctx.setLineDash([5,5]); ctx.lineWidth=1.5; ctx.strokeStyle='rgba(93,64,55,0.4)'; ctx.stroke();
        }
    });
});

const dropFruit = () => {
    if (isGameOver) return;
    if (bgm.paused && !isMuted) bgm.play();
    if (mouseX > 25 && mouseX < 425) {
        World.add(engine.world, createFruit(mouseX, 50, nextLevel));
        if(!isMuted) { soundDrop.currentTime=0; soundDrop.play(); }
        nextLevel = Math.floor(Math.random()*3)+1;
        document.getElementById('next-img').src = FRUITS_CONFIG[nextLevel-1].img;
    }
};
render.canvas.addEventListener('mousedown', dropFruit);
render.canvas.addEventListener('touchstart', (e) => { e.preventDefault(); dropFruit(); }, {passive: false});

Events.on(engine, 'collisionStart', (event) => {
    event.pairs.forEach((pair) => {
        const { bodyA, bodyB } = pair;
        if (bodyA.label === 'deathFloor' || bodyB.label === 'deathFloor') {
            const target = bodyA.label === 'deathFloor' ? bodyB : bodyA;
            if (!target.isEffect && !target.isStatic) gameOverAction();
        }
        if (bodyA.label === bodyB.label && !bodyA.isStatic && !bodyB.isStatic) {
            const currentLevel = parseInt(bodyA.label);
            if (currentLevel < 10) {
                const midX = (bodyA.position.x + bodyB.position.x) / 2;
                const midY = (bodyA.position.y + bodyB.position.y) / 2;
                World.remove(engine.world, [bodyA, bodyB]);
                World.add(engine.world, createFruit(midX, midY, currentLevel+1, true));
                if(!isMuted) { soundMerge.currentTime=0; soundMerge.play(); }
                score += currentLevel*10; document.getElementById('score-val').innerText = score;
                if (currentLevel+1 === 10) setTimeout(() => alert('"ìœ ì¦ˆëŠ” ì˜ì›í•˜ë‹¤" CLEAR!'), 500);
            }
        }
    });
});

function gameOverAction() {
    if (isGameOver) return;
    isGameOver = true; bgm.pause();
    alert(`ì— -ë§ˆìŠ·ë”°... í—ˆì ‘ì´ë‹¤ëƒ (ìµœì¢… ì ìˆ˜: ${score})`); location.reload();
}

Events.on(engine, 'afterUpdate', () => {
    if (isGameOver) return;
    Composite.allBodies(engine.world).forEach(b => {
        if (!b.isStatic && b.circleRadius && !b.isEffect) {
            if (Date.now() - b.spawnTime > 2500 && (b.position.y - b.circleRadius) < 100) gameOverAction();
        }
    });
});

document.getElementById('cheat-btn').addEventListener('click', () => window.open('https://youtu.be/dQw4w9WgXcQ', '_blank'));
document.getElementById('launch-btn').addEventListener('click', () => {
    if (isGameOver) return;
    if (!isMuted) { soundLaunch.currentTime=0; soundLaunch.play(); }
    const c = FRUITS_CONFIG[Math.floor(Math.random()*5)];
    const eb = Bodies.circle(-50, 400, c.radius, { isSensor:true, isEffect:true, render:{sprite:{texture:c.img, xScale:c.scale, yScale:c.scale}} });
    World.add(engine.world, eb); Body.setVelocity(eb, {x:15, y:-5});
    setTimeout(() => World.remove(engine.world, eb), 2000);
});

document.getElementById('bgm-vol').addEventListener('input', (e) => bgm.volume = e.target.value);
document.getElementById('sfx-vol').addEventListener('input', (e) => { soundDrop.volume=e.target.value; soundMerge.volume=e.target.value; soundLaunch.volume=e.target.value; });
document.getElementById('mute-chk').addEventListener('change', (e) => { isMuted=e.target.checked; isMuted ? bgm.pause() : (score>0 && bgm.play()); });
document.getElementById('reset-btn').addEventListener('click', () => { if (confirm("ì§„ì§œë£¨ìš”?")) location.reload(); });

document.getElementById('next-img').src = FRUITS_CONFIG[nextLevel-1].img;
</script>
</body>
</html>
